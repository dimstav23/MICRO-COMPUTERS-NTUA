;DIAVASMA EISODOU APO THN 2000H
;EKSODO ME LED STHN 3000H
;OI EVRESEIS MSB KAI LSB GINONTAI ME ENTOLES OLISTHISEWN 
;DHLADH RAL KAI EPILEGETAI GIA ELEGXOS ALMATOS TA 
;CARRY FLAG KAI ZERO FLAG
;XRHSIMOPOIOUNTAI OI KATAXWRHTES A,B,C,D,E
   	MVI B,00H				;GIA KATHISTERHSH 1MS*100=0.1 SEC
   	MVI C,64H

BEGIN:
	LDA 2000H				;DIAVASMA EISODOU
	RAL					;ELEGXOS MSB
	JC BEGIN				;AN MSB DEN EINAI 0 KSANADIAVASE 
						;EISODO ALLIWS SUNEXISE KATW
LED_1ST_OFF_ON:	

	LDA 2000H				;DIAVASMA EISODOU
	RAL					;DIAKOPTHS UP MSB=1
	JNC LED_1ST_OFF_ON 			;SYNEXISE DIAVASMA MEXRI NA 
						;GINEI UP O DIAKOPTHS

LED_1ST_ON_OFF:			

	LDA 2000H				;DIAVASMA EISODOU 
	RAL					;DIAKOPTHS DOWN MSB=1
	JC LED_1ST_ON_OFF 	;SYNEXISE DIAVASMA MEXRI NA KSANAGINEI OFF


MSLED_ON:			;TO LED EINAI ON OTAN O DIAKOPTHS GINEI DOWN->UP->DOWN
	MVI D,00H		;OFF-ON-OFF DHLADH OPWS ZHTEITAI
	MVI E,C8H		;E = 200 DEKADIKO GIA THN KATHUSTERHSH
	MVI A,7FH		;A=01111111 GIA TO ANAMMA TOU 
	STA 3000H		;PRWTOU LED AFOU EINAI ARNHTIKHS LOGIKHS	

DELAY:				
	CALL DELB		;0.1 SECOND KATHYSTERHSH
	DCR E			;TOY AFAIRW ,KSEKINAEI APO TO 200
	MOV A,E		;CHECK AN TELEIWSOUN TA 20 SECONDS
	CPI 00H		
	JZ TURN_OFF_LED	;AN NAI KLEISE TO LED
	MOV A,D		;AN OXI KATA TH DIARKEIA TWN 20 SECONDS                     
	CPI 00H		;CHECKARW TIS TIMES TOU D GIA NA DW TI KATASTASH EIMAI
	JZ LED_IS_ON		;AN D=0 CHECKARE POU EINAI TWRA
	CPI 01H		;HTAN KATW DHLADH OFF?
	JZ OFF_ON		;AN D=1 CHECKARE POU EINAI TWRA
	CPI 02H		;HTAN PANW AFOU HTAN KATW DHLADH?  
				;EXEI GINEI DLD TO OFF-ON?
	JZ OFF_ON_OFF		;AN D=2 CHECKARE AN PREPEI NA ANANEW8EI
				;DHLADH POU EINAI TWRA TO MSB

TURN_OFF_LED:

	MVI A,FFH
	STA 3000H	;KLEISIMO TOU LED
	JMP BEGIN

LED_IS_ON:

	LDA 2000H		
	RAL
	JC DELAY	;APOFASISE AN EIMASTE SE KATASTASH OFF
	INR D		;APOTHIKEUSE OFF STATE =1

OFF_ON:			; TWRA EXW D = 1

	LDA 2000H
	RAL
	JNC DELAY	;APOFASISE AN EIMASTE SE OFF-ON KATASTASH
	INR D		;APOTHIKEUSE OFF  - ON STATE = 2

	
OFF_ON_OFF:		; TWRA EXW D = 2

	LDA 2000H
	RAL
	JC DELAY ; DES AN EIMAI SE OFF - ON - OFF STATE


REMAINS_ON:
	JMP MSLED_ON		;ANANEWSE TO ORIO XRONOU OTAN PREPEI 
	END

